# This file is used to configure the copl dev environment. It is used to configure the build and hot-pod sections of the copl dev environment.

# The global offset for both sections is the copl bucket. Check the s3 bucket in the account to see the bucket.
#TODO The name format is copl-<account-id>-<region>. The bucket is used to store the build cache and the container image.
# The folder structure inside the bucket follows the format of this config file. 
remote:
#How long the environment will run
  ttl:
#Cloud provider name
  csp: aws
  instance:
  #instance type eg t3.2xlarge
    type:
# The build section is stored in the copl/build folder and the hot-pod section is stored in the copl/hot-pod folder.
build:
  # This is local git repo
  # the copl command can get this as well
  # repo-name: 

  # approot is the name of the directory that the app is in. It is used in three places
  # 1. the location of the build cache
  # 2. the location of the build command to run either inside the container or on the operating system
  # 3. the location of the commands running for app in the container.
  approot: 

  # local build command to run on the operating system
  command: {}  

  # location of the build cache.It resides under the global copl bucket in a subfolder copl/build/cache
  cache:
    location: copl/build/cache/dependencies.tar.gz
    # the location of the cache under the approot
    local: vendor/
# DEPRECATED  We dont use a build container any more. Instead populate the <git-repo>/venbdor directory from s3. When Hot Pod starts it does the build.

# Hot pod is the app that is on the focus. This app runs in hot reloading mode and
# 1. runs the app from the pre-built directory
# 2. syncs the app source code directory with the local source code directory
hotPod:
# Warmup Job is in fact an init container that has virtually-all thesystem tools installed. 
# A nice sample scenario is If you want HotPod to wait until your db is ready and imports data,
# you can add a sleep here, then a mysql import.
  WarmUpJob:
# All your inbound and outboud traffic passes through this sidecar. It mis useful if you need 
# observability metrics, or FQDN overwrites, SSL termination.
  NetworkSidecar:
# Defines the name of app inside the helm chart
  helmValuesSection: bestApp
  image: 
    repository: myrepo
    tag: cuttingedge
  #Read the env vars from an .env file
  env-file:
  # hot pod overrides the commands in the container to run the copl-built app in the previous section
  commands: |
    cd /app-copl
    bundle install
    yarn install
